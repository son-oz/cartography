<!DOCTYPE html>
<html lang="en" data-accent-color="cyan" data-content_root="../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>AWS Configuration - cartography documentation</title><link rel="shortcut icon" href="../../_static/logo-vertical.svg"/><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Permissions Mapping" href="permissions-mapping.html" /><link rel="prev" title="Amazon Web Services (AWS)" href="index.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../../_static/shibuya.css?v=c516b45e" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link media="print" rel="stylesheet" type="text/css" href="../../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=1da16d3f" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-heading: 'Inter', var(--sy-f-sys), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="AWS Configuration"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../index.html">
      <img class="light-logo" src="../../_static/logo-vertical.svg" alt="cartography" height="28" loading="lazy" />
      <img class="dark-logo" src="../../_static/logo-vertical.svg" alt="cartography" height="28" loading="lazy" />
      <strong>cartography</strong>
    </a>
    <div class="sy-head-nav" id="HeadNav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/cartography-cncf/cartography" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a>
  <a href="https://communityinviter.com/apps/cloud-native/cncf" aria-label="Slack">
    <iconify-icon icon="simple-icons:slack"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="HeadNav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Basic Use</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Quick start: Install and Run Cartography On Test Machine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/index.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../usage/tutorial.html">Usage Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/drift-detect.html">How to use Drift-Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/applications.html">Building around Cartography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/samplequeries.html">Sample queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usage/schema.html">Cartography Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ops.html">Cartography Production Operations</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Intel Modules</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../airbyte/index.html">Airbyte</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../airbyte/config.html">Airbyte Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../airbyte/schema.html">Airbyte Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../anthropic/index.html">Anthropic</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../anthropic/config.html">Anthropic Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../anthropic/schema.html">Anthropic Schema</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Amazon Web Services (AWS)</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">AWS Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="permissions-mapping.html">Permissions Mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="schema.html">AWS Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../azure/index.html">Microsoft Azure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../azure/config.html">Azure Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../azure/schema.html">Azure Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bigfix/index.html">BigFix</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../bigfix/config.html">BigFix Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bigfix/schema.html">BigFix Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cloudflare/index.html">Cloudflare</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cloudflare/config.html">Cloudflare Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cloudflare/schema.html">Cloudflare Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../crowdstrike/index.html">Crowdstrike</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../crowdstrike/config.html">Crowdstrike Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../crowdstrike/schema.html">Crowdstrike Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cve/index.html">CVE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cve/config.html">CVE Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cve/schema.html">CVE Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../digitalocean/index.html">DigitalOcean</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../digitalocean/config.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../digitalocean/schema.html">DigitalOcean Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../duo/index.html">Duo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../duo/config.html">Duo Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../duo/schema.html">Duo Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../entra/index.html">Microsoft Entra (formerly Azure AD)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../entra/config.html">Entra Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entra/schema.html">Entra Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entra/schema.html#example-queries">Example Queries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gcp/index.html">Google Cloud Compute (GCP)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../gcp/config.html">GCP Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gcp/schema.html">GCP Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../github/index.html">Github</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../github/config.html">Github Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../github/schema.html">Github Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../gsuite/index.html">Google GSuite</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../gsuite/config.html">GSuite Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gsuite/config.html#method-2-using-oauth">Method 2: Using OAuth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gsuite/schema.html">GSuite Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../jamf/index.html">Jamf</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../jamf/schema.html">Jamf Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kandji/index.html">Kandji</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../kandji/config.html">Kandji Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kandji/schema.html">Kandji Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kubernetes/index.html">Kubernetes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../kubernetes/config.html">Kubernetes Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kubernetes/schema.html">Kubernetes Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lastpass/index.html">Lastpass</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lastpass/config.html">Lastpass Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lastpass/schema.html">Lastpass Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../oci/index.html">Oracle Cloud Infrastructure</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../oci/config.html">OCI Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../oci/schema.html">OCI Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../okta/index.html">Okta</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../okta/config.html">Okta Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../okta/schema.html">Okta Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../openai/index.html">OpenAI</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../openai/config.html">OpenAI Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openai/schema.html">OpenAI Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pagerduty/index.html">PagerDuty</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../pagerduty/config.html">Pagerduty Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pagerduty/schema.html">Pagerduty Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../scaleway/index.html">Scaleway</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../scaleway/config.html">Scaleway Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scaleway/schema.html">Scaleway Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../semgrep/index.html">Semgrep</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../semgrep/config.html">Semgrep Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../semgrep/schema.html">Semgrep Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sentinelone/index.html">SentinelOne</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sentinelone/config.html">SentinelOne Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sentinelone/config.html#required-permissions">Required Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sentinelone/schema.html">SentinelOne Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../snipeit/index.html">SnipeIT</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../snipeit/config.html">SnipeIT Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../snipeit/schema.html">SnipeIT Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tailscale/index.html">Tailscale</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tailscale/config.html">Tailscale Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tailscale/schema.html">Tailscale Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../trivy/index.html">Trivy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../trivy/config.html">Trivy Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trivy/config.html#notes-on-running-trivy">Notes on running Trivy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trivy/schema.html">Trivy Schema</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Development Docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dev/developer-guide.html">Cartography Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/writing-intel-modules.html">How to write a new intel module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev/writing-analysis-jobs.html">How to extend Cartography with Analysis Jobs</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Get In Touch</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html#community-meeting">Community Meeting</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#very-helpful-references">Very helpful references</a></li>
<li><a class="reference internal" href="#single-aws-account-setup">Single AWS Account Setup</a></li>
<li><a class="reference internal" href="#multiple-aws-account-setup">Multiple AWS Account Setup</a></li>
</ul>
</div><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/cartography-cncf/cartography"
  data-type="github" data-user="cartography-cncf" data-repo="cartography">
  <span class="w-8 flex items-center justify-around shrink-0 text-3xl">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </span>
  <span class="flex-grow px-2 break-all">
    <span>cartography-cncf/cartography</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <iconify-icon icon="lucide:star"></iconify-icon>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <iconify-icon icon="lucide:git-fork"></iconify-icon>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div class="edit-this-page">
  <a href="https://github.com/cartography-cncf/cartography/blob/master/docs/root/modules/aws/config.md">Edit this page</a>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6"><div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">cartography</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Amazon Web Services (AWS)</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">AWS Configuration</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="aws-configuration">
<h1>AWS Configuration<a class="headerlink" href="#aws-configuration" title="Link to this heading">¶</a></h1>
<p>Follow these steps to analyze AWS assets with Cartography.</p>
<p>In a nutshell, Cartography uses the <a class="reference external" href="https://github.com/boto/boto3">boto3</a> library to retrieve assets from AWS and respects all settings and credentials passed to boto3. If you’ve used boto3 before, then you’re already very familiar with setting up Cartography for AWS.</p>
<section id="very-helpful-references">
<h2>Very helpful references<a class="headerlink" href="#very-helpful-references" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Ensure your ~/.aws/credentials and ~/.aws/config files are set up correctly: <a class="reference external" href="https://docs.aws.amazon.com/cli/v1/userguide/cli-configure-files.html">https://docs.aws.amazon.com/cli/v1/userguide/cli-configure-files.html</a></p></li>
<li><p>Review the various AWS environment variables: <a class="reference external" href="https://docs.aws.amazon.com/cli/v1/userguide/cli-configure-envvars.html">https://docs.aws.amazon.com/cli/v1/userguide/cli-configure-envvars.html</a></p></li>
<li><p>Refer to boto3’s standard order of precedence when retrieving credentials: <a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html#configuring-credentials">https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html#configuring-credentials</a></p></li>
</ul>
</section>
<section id="single-aws-account-setup">
<h2>Single AWS Account Setup<a class="headerlink" href="#single-aws-account-setup" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Set up an AWS identity (user, group, or role) for Cartography to use. Ensure that this identity has the built-in AWS <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_job-functions.html#jf_security-auditor">SecurityAudit policy</a> (arn:aws:iam::aws:policy/SecurityAudit) attached. This policy grants access to read security config metadata.</p>
<ol class="arabic simple">
<li><p>If you want to use AWS Inspector, the SecurityAudit policy does not yet contain permissions for <code class="docutils literal notranslate"><span class="pre">inspector2</span></code>, so you will also need the <a class="reference external" href="https://docs.aws.amazon.com/inspector/latest/user/security-iam-awsmanpol.html#security-iam-awsmanpol-AmazonInspector2ReadOnlyAccess">AmazonInspector2ReadOnlyAccess policy</a>.</p></li>
</ol>
</li>
<li><p>Set up AWS credentials to this identity on your server, using a <code class="docutils literal notranslate"><span class="pre">config</span></code> and <code class="docutils literal notranslate"><span class="pre">credential</span></code> file.  For details, see AWS’ <a class="reference external" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html">official guide</a>.</p></li>
<li><p>[Optional] Configure AWS Retry settings using <code class="docutils literal notranslate"><span class="pre">AWS_MAX_ATTEMPTS</span></code> and <code class="docutils literal notranslate"><span class="pre">AWS_RETRY_MODE</span></code> environment variables. This helps in API Rate Limit throttling and TooManyRequestException related errors. For details, see AWS’ <a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/configuration.html#using-environment-variables">official guide</a>.</p></li>
</ol>
</section>
<section id="multiple-aws-account-setup">
<h2>Multiple AWS Account Setup<a class="headerlink" href="#multiple-aws-account-setup" title="Link to this heading">¶</a></h2>
<p>There are many ways to allow Cartography to pull from more than one AWS account.  We can’t cover all of them, but here’s one way that works at Lyft.  In this scenario we will assume that you are going to run Cartography on an EC2 instance.</p>
<ol class="arabic">
<li><p>Pick one of your AWS accounts to be the “<strong>Hub</strong>” account.  This Hub account will pull data from all of your other accounts - we’ll call those “<strong>Spoke</strong>” accounts.</p></li>
<li><p><strong>Set up the IAM roles</strong>: Create an IAM role named <code class="docutils literal notranslate"><span class="pre">cartography-read-only</span></code> on <em>all</em> of your accounts.  Configure the role on all accounts as follows:</p>
<ol class="arabic">
<li><p>Attach the built-in AWS <a class="reference external" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_job-functions.html#jf_security-auditor">SecurityAudit IAM policy</a> (arn:aws:iam::aws:policy/SecurityAudit) to the role.  This grants access to read security config metadata.</p></li>
<li><p>Set up a trust relationship so that the Spoke accounts will allow the Hub account to assume the <code class="docutils literal notranslate"><span class="pre">cartography-read-only</span></code> role.  The resulting trust relationship should look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2">  <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span data-line="3">  <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span data-line="4">    <span class="p">{</span>
</span><span data-line="5">      <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span data-line="6">      <span class="s2">&quot;Principal&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span data-line="7">        <span class="s2">&quot;AWS&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:iam::&lt;Hub&#39;s account number&gt;:root&quot;</span>
</span><span data-line="8">      <span class="p">},</span>
</span><span data-line="9">      <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;sts:AssumeRole&quot;</span>
</span><span data-line="10">    <span class="p">}</span>
</span><span data-line="11">  <span class="p">]</span>
</span><span data-line="12"><span class="p">}</span>
</span></pre></div>
</div>
</li>
<li><p>Allow a role in the Hub account to <strong>assume the <code class="docutils literal notranslate"><span class="pre">cartography-read-only</span></code> role</strong> on your Spoke account(s).</p>
<ul>
<li><p>On the Hub account, create a role called <code class="docutils literal notranslate"><span class="pre">cartography-service</span></code>.</p></li>
<li><p>On this new <code class="docutils literal notranslate"><span class="pre">cartography-service</span></code> role, add an inline policy with the following JSON:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2">  <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
</span><span data-line="3">  <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span data-line="4">    <span class="p">{</span>
</span><span data-line="5">      <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span data-line="6">      <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;arn:aws:iam::*:role/cartography-read-only&quot;</span><span class="p">,</span>
</span><span data-line="7">      <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;sts:AssumeRole&quot;</span>
</span><span data-line="8">    <span class="p">},</span>
</span><span data-line="9">	<span class="p">{</span>
</span><span data-line="10">	  <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
</span><span data-line="11">	  <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;ec2:DescribeRegions&quot;</span><span class="p">,</span>
</span><span data-line="12">	  <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
</span><span data-line="13">	<span class="p">}</span>
</span><span data-line="14">  <span class="p">]</span>
</span><span data-line="15"><span class="p">}</span>
</span></pre></div>
</div>
<p>This allows the Hub role to assume the <code class="docutils literal notranslate"><span class="pre">cartography-read-only</span></code> role on your Spoke accounts and to fetch all the different regions used by the Spoke accounts.</p>
</li>
<li><p>When prompted to name the policy, you can name it anything you want - perhaps <code class="docutils literal notranslate"><span class="pre">CartographyAssumeRolePolicy</span></code>.</p></li>
</ul>
</li>
</ol>
</li>
<li><p><strong>Set up your EC2 instance to correctly access these AWS identities</strong></p>
<ol class="arabic">
<li><p>Attach the <code class="docutils literal notranslate"><span class="pre">cartography-service</span></code> role to the EC2 instance that you will run Cartography on.  You can do this by following <a class="reference external" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html#attach-iam-role">these official AWS steps</a>.</p></li>
<li><p>Ensure that the <code class="docutils literal notranslate"><span class="pre">[default]</span></code> profile in your <code class="docutils literal notranslate"><span class="pre">AWS_CONFIG_FILE</span></code> file (default <code class="docutils literal notranslate"><span class="pre">~/.aws/config</span></code> in Linux, and <code class="docutils literal notranslate"><span class="pre">%UserProfile%\.aws\config</span></code> in Windows) looks like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span data-line="1"> [default]
</span><span data-line="2"> region=&lt;the region of your Hub account, e.g. us-east-1&gt;
</span><span data-line="3"> output=json
</span></pre></div>
</div>
</li>
<li><p>Add a profile for each AWS account you want Cartography to sync with to your <code class="docutils literal notranslate"><span class="pre">AWS_CONFIG_FILE</span></code>.  It will look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">[</span><span class="n">profile</span> <span class="n">accountname1</span><span class="p">]</span>
</span><span data-line="2"><span class="n">role_arn</span> <span class="o">=</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="o">&lt;</span><span class="n">AccountId</span><span class="c1">#1&gt;:role/cartography-read-only</span>
</span><span data-line="3"><span class="n">region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span>
</span><span data-line="4"><span class="n">output</span><span class="o">=</span><span class="n">json</span>
</span><span data-line="5"><span class="n">credential_source</span> <span class="o">=</span> <span class="n">Ec2InstanceMetadata</span>
</span><span data-line="6">
</span><span data-line="7"><span class="p">[</span><span class="n">profile</span> <span class="n">accountname2</span><span class="p">]</span>
</span><span data-line="8"><span class="n">role_arn</span> <span class="o">=</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="o">&lt;</span><span class="n">AccountId</span><span class="c1">#2&gt;:role/cartography-read-only</span>
</span><span data-line="9"><span class="n">region</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span>
</span><span data-line="10"><span class="n">output</span><span class="o">=</span><span class="n">json</span>
</span><span data-line="11"><span class="n">credential_source</span> <span class="o">=</span> <span class="n">Ec2InstanceMetadata</span>
</span><span data-line="12">
</span><span data-line="13"><span class="o">...</span> <span class="n">etc</span> <span class="o">...</span>
</span></pre></div>
</div>
</li>
</ol>
</li>
<li><p>[Optional] Configure AWS Retry settings using <code class="docutils literal notranslate"><span class="pre">AWS_MAX_ATTEMPTS</span></code> and <code class="docutils literal notranslate"><span class="pre">AWS_RETRY_MODE</span></code> environment variables. This helps in API Rate Limit throttling and TooManyRequestException related errors. For details, see AWS’ <a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/configuration.html#using-environment-variables">official guide</a>.</p></li>
</ol>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="index.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Amazon Web Services (AWS)</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="permissions-mapping.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Permissions Mapping</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2021-2025, The Linux Foundation</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/cartography-cncf/cartography" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a>
<a href="https://communityinviter.com/apps/cloud-native/cncf" aria-label="Slack">
  <iconify-icon icon="simple-icons:slack"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/shibuya.js?v=e2230717"></script></body>
</html>